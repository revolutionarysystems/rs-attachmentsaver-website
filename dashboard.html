<!DOCTYPE html>
<html id="dashboard" lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
  <title>AttachmentSaver - Dashboard</title>

  <!-- CSS  -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link href="css/style.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css">
<!--   <link rel="stylesheet" href="https://get.mavo.io/mavo.css"/>
  <script src="https://get.mavo.io/mavo.js"></script> -->
</head>
<body class="deep-purple lighten-1 white-text flow-text">

  <div class="navbar-fixed">
    <nav class="blue-grey darken-2" role="navigation">
      <div class="nav-wrapper container">
        <a id="logo-container" href="/" class="brand-logo"><img class="responsive-img" src="img/attachmentsaver-white.png" alt="Logo"></a>
        <div class="right" data-netlify-identity-menu></div>
      </div>
    </nav>
  </div>

  <div class="container">
    <div class="row">
      <div class="col s12">
        <ul id="uiTabs" class="tabs transparent">
          <li class="tab col s3 xdisabled"><a href="#activity">Activity</a></li>
          <li class="tab col s3 xdisabled"><a href="#settings">Settings</a></li>
          <li class="tab col s3 xdisabled"><a href="#billing">Billing</a></li>
        </ul>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="row">
      <div id="activity" class="col s12">
        <div class="panel white grey-text text-darken-3">
          <div id="activityContent" class="tabContent"></div>
        </div>
      </div>
      <div id="settings" class="col s12">
        <div class="panel white grey-text text-darken-3">
          <div id="settingsContent" class="tabContent"></div>
        </div>
      </div>
      <div id="billing" class="col s12">
        <div class="panel white grey-text text-darken-3">
          <div id="billingContent" class="tabContent"></div>
        </div>        
      </div>
    </div>
  </div>

  <footer class="page-footer blue-grey darken-2">
    <div class="container small center">
      <p>A brand of <a href="www.revolutionarysystems.co.uk">Revolutionary Systems</a></p>
    </div>
    <div class="footer-copyright darken-4">
      <div class="container small">
        v0.15
      </div>
    </div>
  </footer>

  <div id="baseModal" class="modal" mv-app mv-storage="local">
    <div class="modal-content black-text">
      <h4>Set a base name</h4>
      <p>Looks like it's your first time here.</p>
      <p>Please choose a unique <em>base name</em> that we can use to identify your account.  The base name is used to help form the email addresses that you will set up (e.g. test-<b>[if(basename.length > 0, basename, 'basename')]</b>@attachmentsaver.com).</p>
      <p class="small">A good base name is between 3 and 8 characters long, and must not contain any non-letter characters</p>
      <form class="row">
        <div class="col s9">
          Base name:
          <div class="input-field inline">
            <input id="basename" property type="text" class="validate" required minlength="3" maxlength="12" pattern="[a-zA-Z0-9]{3,12}">
            <!-- <span class="helper-text" data-error="wrong" data-success="right">A good base name is between 3 and 8 characters long, and must not contain any non-letter characters</span> -->
          </div>
        </div>
        <div class="col s3">
          <a class="waves-effect waves-light btn"><i class="material-icons left">offline_pin</i>check</a>
        </div>
      </form>
    </div>
<!--     <div class="modal-footer orange">
      <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat">Done</a>
    </div> -->
  </div>

  <!--  Scripts-->
  <!-- <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script> -->
<!--   <script>
    Mavo.Backend.register($.Class({
      extends: Mavo.Backend,
      id: "netlify",
      constructor: function(url, {mavo, format}) {
        // Initialization code

        // Already defined by the parent constructor:
        this.source // Raw URL (attribute value)
        this.url // URL object from this.source
        this.mavo // Mavo instance
        this.format // Current format
        this.permissions // Permissions of this particular backend.
      },
      // Low-level functions for reading data. You don’t need to implement this
      // if the mv-storage/mv-source value is a URL and reading the data is just
      // a GET request to that URL.
      get: function(url) {
        // Should return a promise that resolves to the data as a string or object
      },
      // High level function for reading data. Calls this.get().
      // You rarely need to override this.
      load: function() {
        // Should return a promise that resolves to the data as an object
      },
      // Low-level saving code.
      // serialized: Data serialized according to this.format
      // path: Path to store data
      // o: Arbitrary options
      put: function(serialized, path = this.path, o = {}) {
        // Returns promise
      },
      // If your backend supports uploads, this is mandatory.
      // file: File object to be uploaded
      // path: relative path to store uploads (e.g. "images")
      upload: function(file, path) {
        // Upload code. Should call this.put()
      },
      // High level function for storing data.
      // You rarely need to override this, except to avoid serialization.
      store: function(data, {path, format = this.format} = {}) {
        // Should return a promise that resolves when the data is saved successfully
      },
      // Takes care of authentication. If passive is true, only checks if
      // the user is already logged in, but does not present any login UI.
      // Typically, you’d call this.login(true) in the constructor
      login: function(passive) {
        // Typically, you’d check if a user is already authenticated
        // and return Promise.resolve() if so.

        // Returns promise that resolves when the user has successfully authenticated
      },
      // Log current user out
      logout: function() {
        // Returns promise
      },
      static: {
        // Mandatory and very important! This determines when your backend is used.
        // value: The mv-storage/mv-source/mv-init value
        test: function(value) {
          // Returns true if this value applies to this backend
        }
      }
    }));
  </script>
 -->  
  <script src="js/materialize.js"></script>
  <script>
    var uiTabs = M.Tabs.init(document.getElementById('uiTabs'), {swipeable: true});
  </script>
  <!-- <script src="js/init.js"></script> -->
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  <script>
    $(function(){
      netlifyIdentity.on("error", err => console.error(err));
      netlifyIdentity.on("logout", () => location.reload());
      netlifyIdentity.on("login", user => {
          console.log('logged in', user.email, user.id);

          if (!user.user_metadata.base) {
            console.log('need to set base');
            var instance = M.Modal.init(document.getElementById('baseModal', {dismissible: false}));
            instance.open();
          }
      });
    });
  </script>
</body>
</html>
